#!/bin/bash

#Checking that everything's okay
{ ! [ -d ~/bridge ] || [ -z "$1" ];} && exit 1

#Checking if argument is valid and setting variables
if [ "$1" -eq 0 ]; then 
	device='pc';
	devicename='Desktop-Pc';
fi

if [ "$1" -eq 1 ]; then
	device='nb';
	devicename='Notebook';
fi

{ [ -z "$device" ] || [ -z "$devicename" ];} && exit 1

#Pulling changes from repo
cd ~/bridge || exit 1;
git pull;

#Updating data locally
cd "/home/js/bridge/data/$device" || exit 1;

#Deleting old data

dig @resolver4.opendns.com myip.opendns.com +short 2>/dev/null > public-ip
ip a | grep 192.168 | awk "{print \$2}" | sed 's/\/.*//g' 2>/dev/null > private-ip

#Pushing changes
git add .;
git commit -m "$(date '+%Y-%m-%d %H:%M:%S'): Updated -> $devicename";
git push;
